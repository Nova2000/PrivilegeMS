
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>首页</title>
    <script src="~/Scripts/vue.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <script src="~/Scripts/axios.min.js"></script>
    <style>
        .container-fluid {
            margin-top: 20px;
        }

        .input-group {
            margin: 10px 0 20px 0;
        }

        .right {
            float: right;
        }

        .panel-body, .info th {
            text-align: center;
        }
    </style>

</head>
<body>
    <div class="container-fluid" id="user">
        <div class="col-lg-6">
            <div id="userList">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3>用户信息</h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-bordered table-hover ">
                            <tr class="info">
                                <th>序号</th>
                                <th>姓名</th>
                                <th>账号</th>
                                <th>密码</th>
                                <th>注册时间</th>
                                <th>操作</th>
                            </tr>
                            <!-- :class="{'trs':i%2==0}" -->
                            <tr v-for="(item,i) in jsondata" :key="i" :class="{'trs':i%2==0}">
                                <td v-text="item.ID"></td>
                                <td v-text="item.Name"></td>
                                <td v-text="item.AccountNum">123456789</td>
                                <td v-text="item.Pwd">123456789</td>
                                <td>{{item.SubTime | timeFormat('en')}}</td>
                                <td><a class="btn btn-danger" v-on:click="deluser(item.ID)">删除</a></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div  class="panel panel-info">
                <div class="panel-heading">
                    <h3>添加用户</h3>
                </div>
                <div class="panel-body">
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">姓名</span>
                        <input type="text" class="form-control" placeholder="请输入用户名" aria-describedby="basic-addon1" v-model="name">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">账户</span>
                        <input type="text" class="form-control" placeholder="9位数字账户" aria-describedby="basic-addon1" v-model="accountNum">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">密码</span>
                        <input type="password" class="form-control" placeholder="请输入密码" aria-describedby="basic-addon1" v-model="pwd" v-on:keyup.enter="adduser">
                    </div>
                    <button class="btn btn-success right" v-on:click="adduser">提交</button>
                </div>
                
                    
                
            </div>
        </div>
    </div>
    
</body>
<script>
    var user = new Vue({
        el: "#user",
        data: {
            //获取userList
            userListApiUrl: '/Home/UserList',
            jsondata: [],
            Student: [
                { name: "李瑞森", studentID: "164804131" }
            ],
            //添加user
            addUserApiUrl: '/Home/AddUser',
            name: '',
            accountNum: '',
            pwd: '',
            deleteApiUrl:'/Home/DeleteUser'
        },
        methods: {
            getRequest: function () {
                //this.$http.get(this.apiUrl).then(function (res) {
                //    this.jsondata = res.body;
                //})
                axios.get(this.userListApiUrl).then(function (res) {
                    user.jsondata = res.data;
                })
            },
            timeFormat: function (time) {
                var times = new Date(time);
                return times;
            },
            adduser: function () {
                if (this.accountNum.length == 9 && this.pwd.length > 0 && this.name.length > 0) {
                    axios.post(this.addUserApiUrl, {
                        name: this.name,
                        accountNum: this.accountNum,
                        pwd: this.pwd
                    }).then(function (respose) {
                        if (respose.data == "ok") {
                            user.accountNum = user.pwd = user.name = '';
                            user.getRequest();
                           
                        } else {
                            alert("添加失败")
                        }
                    })
                } else {
                    alert("输入信息不合法");
                }

            },
            deluser: function (itemId) {
                //alert(id);
                var flag = confirm("确认删除序号为 " + itemId + " 的记录吗？")
                if (flag) {
                    axios.post(this.deleteApiUrl, {
                        id: itemId
                    }).then(function (respose) {
                        if (respose.data == 'ok') {
                            user.getRequest();

                        } else {
                            alert("删除失败")
                        }
                    })
                }
            }
        },

        created() {
            this.getRequest();
        },
        filters: {
            timeFormat: function (dateStr, pattern) {
                var t = dateStr.slice(6, 19) 
                var date = new Date(parseInt(t));
                var year = date.getFullYear();
                var month = date.getMonth() + 1;
                var day = date.getDate();
                var result = '';
                if (pattern) {
                    switch (pattern.toLowerCase()) {
                        case 'cn':
                            result = year + '年' + month + '月' + day + '日';
                            break;
                        case 'en':
                            result = year + '-' + month + '-' + day;
                            break;
                        default:
                            result = year + '.' + month + '.' + day;
                            break;
                    }
                } else {
                    result = year + '.' + month + '.' + day;
                }
                return result;
            }
        }
    })
    //var addUser = new Vue({
    //    el: "#addUser",
    //    data: {
            
    //    },
    //    methods: {
           
    //    }
    //})
</script>
</html>

