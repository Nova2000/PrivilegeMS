
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>首页</title>
    <script src="~/Scripts/vue.min.js"></script>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.0/animate.min.css">
    <script src="~/Scripts/axios.min.js"></script>
    <style>
        .container-fluid {
            margin-top: 20px;
        }

        .input-group {
            margin: 10px 0 10px 0;
        }

        .float-right {
            float: right;
        }

        .float-left {
            float:left;
        }

        .panel-body, .info th {
            text-align: center;
        }

        .btn-sm {
            margin: 0 5px;
        }

        a {
            cursor: pointer;
        }

        .btn-sm {
            display: inline;
        }
    </style>

</head>
<body>
    <div class="container-fluid" id="user">
        <div class="col-lg-6 animated fadeIn float-right">
            <div id="userList">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3>用户信息</h3>
                    </div>
                    <div class="panel-body">
                        <table class="table  table-hover table-bordered">
                            <thead>
                                <tr class="info">
                                    <th>序号</th>
                                    <th>姓名</th>
                                    <th>账号</th>
                                    <th>密码</th>
                                    <th>注册时间</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <!-- :class="{'trs':i%2==0}" -->
                            <tbody>
                                <tr v-for="(item,i) in jsondata" :key="i" :class="{'trs':i%2==0}">
                                    <td v-text="i+1"></td>
                                    <td v-text="item.Name"></td>
                                    <td v-text="item.AccountNum">123456789</td>
                                    <td v-text="item.Pwd">123456789</td>
                                    <td>{{item.SubTime | timeFormat('en')}}</td>
                                    <td>
                                        <a class=" btn btn-danger btn-sm" v-on:click="deluser(i,item.ID)">删除</a>
                                        <a class="btn btn-success btn-sm" v-on:click="editpanelOpen(item.Name)">修改</a>
                                        <a class="btn btn-info btn-sm" v-on:click="">权限</a>

                                    </td>
                                </tr>
                            </tbody>

                        </table>
                        @*<ul class="pagination">
                                <li><a href="#">&laquo;</a></li>
                                <li><a href="#">1</a></li>
                            </ul>*@
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6 animated fadeIn">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3>添加用户</h3>
                </div>
                <div class="panel-body">
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">姓名</span>
                        <input type="text" class="form-control" placeholder="请输入用户名" aria-describedby="basic-addon1" v-model="name">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">账户</span>
                        <input type="text" class="form-control" placeholder="9位数字账户" aria-describedby="basic-addon1" v-model="accountNum">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">密码</span>
                        <input type="password" class="form-control" placeholder="请输入密码" aria-describedby="basic-addon1" v-model="pwd" v-on:keyup.enter="adduser">
                    </div>
                    <button class="btn btn-success right" v-on:click="adduser">提交</button>
                </div>
            </div>
        </div>
        <div class="col-lg-6 animated fadeIn" v-show="showFlag">
            <div class="panel panel-warning">
                <div class="panel-heading">
                    <h3>修改用户</h3>
                </div>
                <div class="panel-body">
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">账户</span>
                        <input type="text" class="form-control" placeholder="请输入用户名" aria-describedby="basic-addon1" v-model="Student.useraccountNum" readonly>
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">姓名</span>
                        <input type="text" class="form-control" placeholder="请输入用户名" aria-describedby="basic-addon1" v-model="Student.editname">
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1">密码</span>
                        <input type="text" class="form-control" placeholder="请输入密码" aria-describedby="basic-addon1" v-model="Student.editpwd" v-on:keyup.enter="">
                    </div>
                    <button class="btn btn-default float-left" v-on:click="editpanelClose">关闭</button>
                    <button class="btn btn-success float-right" v-on:click="edituser">提交</button>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var user = new Vue({
        el: "#user",
        data: {
            //获取userList
            userListApiUrl: '/Home/UserList',
            jsondata: [],
            //添加user
            addUserApiUrl: '/Home/AddUser',
            name: '',
            accountNum: '',
            pwd: '',
            //修改用户
            editUserApiUrl:'/Home/EditUser',
            showFlag: false,
            Student: [
                { editname: '', userID: "", editpwd: "", useraccountNum: "" }
            ],
        },
        methods: {
            getRequest: function () {
                //this.$http.get(this.apiUrl).then(function (res) {
                //    this.jsondata = res.body;
                //})
                axios.get(this.userListApiUrl).then(function (res) {
                    user.jsondata = res.data;
                })
            },
            timeFormat: function (time) {
                var times = new Date(time);
                return times;
            },
            adduser: function () {
                if (this.accountNum.length == 9 && this.pwd.length > 0 && this.name.length > 0) {
                    axios.post(this.addUserApiUrl, {
                        name: this.name,
                        accountNum: this.accountNum,
                        pwd: this.pwd
                    }).then(function (respose) {
                        if (respose.data == "ok") {
                            user.accountNum = user.pwd = user.name = '';
                            user.getRequest();

                        } else {
                            alert("添加失败")
                        }
                    })
                } else {
                    alert("输入信息不合法");
                }

            },
            deluser: function (i, itemId) {
                //alert(id);
                var flag = confirm("确认删除序号为 " + (i + 1) + " 的记录吗？")
                if (flag) {
                    axios.post(this.deleteApiUrl, {
                        id: itemId
                    }).then(function (respose) {
                        if (respose.data == 'ok') {
                            user.getRequest();

                        } else {
                            alert("删除失败")
                        }
                    })
                }
            },
            editpanelOpen: function (userID) {
                if (!this.showFlag) {
                    this.showFlag = true;
                    var stu = this.jsondata.filter(item => {
                        if (item.Name.includes(userID)) {
                            return true;
                        }
                    })
                    this.Student.userID = stu["0"].ID;
                    this.Student.editname = stu["0"].Name;
                    this.Student.useraccountNum = stu["0"].AccountNum;
                    this.Student.editpwd = stu["0"].Pwd;
                } else {
                    alert("请修改或关闭当前用户数据!");
                }
            },
            editpanelClose: function () {
                this.showFlag = false;
                this.Student = [
                    { editname: '', userID: "", editpwd: "", useraccountNum: "" }
                ];
            },
            edituser: function () {
                if (this.Student.editname != "" && this.Student.userID != "" && this.Student.editpwd != "" && this.Student.useraccountNum != "") {
                    axios.post(this.editUserApiUrl, {
                        id: this.Student.userID,
                        name: this.Student.editname,
                        pwd: this.Student.editpwd
                    }).then(respose => {
                        if (respose.data == "ok") {
                            alert("修改成功！");
                            user.editpanelClose();
                            user.getRequest();

                        } else {
                            alert("修改失败")
                        }
                    });
                } else {
                    alert("请检查输入信息是否完整！")
                }
            }
        },

        created() {
            this.getRequest();
        },
        filters: {
            timeFormat: function (dateStr, pattern) {
                var t = dateStr.slice(6, 19)
                var date = new Date(parseInt(t));
                var year = date.getFullYear();
                var month = date.getMonth() + 1;
                var day = date.getDate();
                var result = '';
                if (pattern) {
                    switch (pattern.toLowerCase()) {
                        case 'cn':
                            result = year + '年' + month + '月' + day + '日';
                            break;
                        case 'en':
                            result = year + '-' + month + '-' + day;
                            break;
                        default:
                            result = year + '.' + month + '.' + day;
                            break;
                    }
                } else {
                    result = year + '.' + month + '.' + day;
                }
                return result;
            }
        }
    })

</script>
</html>

